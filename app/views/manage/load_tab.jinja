<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/2.0.7/css/dataTables.bootstrap5.min.css">

<div class="container py-4">
    <h2 class="mb-4 text-center">Manage Blog Posts</h2>
    <table id="blogTable" class="table table-striped table-bordered align-middle" style="width:100%">
        <thead class="table-light">
            <tr>
                <th>Title</th>
                <th>Description</th>
                <th>Date Created</th>
                <th>Date Modified </th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for item in blog %}
            <tr>
                <td>{{ item.title }}</td>
                <td>{{ item.description }}</td>
                <td>{{ item.datetime_of_creation }}</td>
                <td> {{ item.datetime_of_update }} </td>
                <td>
                    <button class="btn btn-sm btn-warning me-2 edit-btn" data-id="{{ item.id }}" onclick="if(confirm('Edit this post?')) window.location.href='http://localhost:44777/edit_blog/{{ item.id }}';">Edit</button>
                    <form method="post" action="/delete_blog/{{ item.id }}/" class="d-inline">
                        <button class="btn btn-sm btn-danger delete-btn" onclick="if(confirm('Delete this post?'))" data-id="{{ item.id }}">Delete</button>
                    </form>                   
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Pagination Controls -->
    <div class="d-flex justify-content-center mt-4">
        <nav>
            <ul class="pagination">
                {% if page > 1 %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page - 1 }}&limit={{ limit }}">Previous</a>
                </li>
                {% endif %}
                {% for p in range(1, pages + 1) %}
                <li class="page-item {% if p == page %}active{% endif %}">
                    <a class="page-link" href="?page={{ p }}&limit={{ limit }}">{{ p }}</a>
                </li>
                {% endfor %}
                {% if page < pages %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page + 1 }}&limit={{ limit }}">Next</a>
                </li>
                {% endif %}
            </ul>
        </nav>
    </div>
    <button class="btn btn-sm btn-danger" onclick="if(confirm('Go back to home page?')) window.location.href='http://localhost:44777/'">Back</button>

</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/2.0.7/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/2.0.7/js/dataTables.bootstrap5.min.js"></script>
<script>
    $(document).ready(function() {
        $('#blogTable').DataTable({
            "paging": false, // Disable DataTables' own paging to use server-side paging
            "info": false
        });

        // Edit button click
        $('.edit-btn').on('click', function() {
            const id = $(this).data('id');
            window.location.href = 'http://localhost:44777/edit_blog/' + id;
        });

        // Delete button click
        $('#blogTable').on('click', '.delete-btn', function() {
            const id = $(this).data('id');
            if (confirm('Are you sure you want to delete this post?')) {
                $.ajax({
                    url: '/delete_blog/' + id + '/', // Adjust URL if needed
                    type: 'DELETE',
                    success: function(result) {
                        location.reload();
                    },
                    error: function() {
                        alert('Failed to delete post.');
                    }
                });
            }
        });
    });
</script>